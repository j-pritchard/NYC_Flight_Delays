"0","library(leaflet)"
"0",""
"0","# worst routes and geodata"
"0","worst_routes <- departures %>% "
"0","  filter(origin == ""EWR"") %>%"
"0","  group_by(carrier, flight, dest) %>% "
"0","  reframe(number = n(),"
"0","          prop_delayed = sum(delayed_flag)/n(),"
"0","          mean_delay = mean(dep_delay),"
"0","          origin_lat, origin_lon, dest, dest_name, dest_lat, dest_lon) %>% "
"0","  filter(number >= 10,"
"0","         prop_delayed > 0.5) %>% "
"0","  ungroup() %>% "
"0","  distinct() %>% "
"0","  mutate(id = row_number(), .before = carrier)"
"0",""
"0","# flight routes"
"0","worst_routes_lines <- data.frame("
"0","  id = worst_routes$id,"
"0","  lat = c(worst_routes$origin_lat, worst_routes$dest_lat),"
"0","  lon = c(worst_routes$origin_lon, worst_routes$dest_lon)"
"0",") %>% "
"0","  arrange(id)"
"0",""
"0","# map"
"0","worst_routes %>% "
"0","  leaflet() %>% "
"0","  addTiles() %>% "
"0","  addCircleMarkers(lat = ~dest_lat, lng = ~dest_lon,"
"0","                   radius = 4, weight = 2,"
"0","                   label = ~dest_name) %>%"
"0","  addPolylines(lat = worst_routes_lines$lat,"
"0","               lng = worst_routes_lines$lon,"
"0","               weight = 1)"
